{"ast":null,"code":"var _jsxFileName = \"/home/lenovo/IdeaProjects/lets-chat/frontend/src/components/chat/ChatRoom.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from \"react\";\nimport { getMessagesOfChatRoom, sendMessage } from \"../../services/ChatService\";\nimport Message from \"./Message\";\nimport Contact from \"./Contact\";\nimport ChatForm from \"./ChatForm\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatRoom({\n  currentChat,\n  currentUser,\n  socket\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [incomingMessage, setIncomingMessage] = useState(null);\n  const scrollRef = useRef();\n  useEffect(() => {\n    const fetchData = async () => {\n      const res = await getMessagesOfChatRoom(currentChat._id);\n      setMessages(res);\n    };\n    fetchData();\n  }, [currentChat._id]);\n  useEffect(() => {\n    var _scrollRef$current;\n    (_scrollRef$current = scrollRef.current) === null || _scrollRef$current === void 0 ? void 0 : _scrollRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  useEffect(() => {\n    var _socket$current;\n    (_socket$current = socket.current) === null || _socket$current === void 0 ? void 0 : _socket$current.on(\"getMessage\", data => {\n      setIncomingMessage({\n        senderId: data.senderId,\n        message: data.message\n      });\n    });\n  }, [socket]);\n  useEffect(() => {\n    incomingMessage && setMessages(prev => [...prev, incomingMessage]);\n  }, [incomingMessage]);\n  const handleFormSubmit = async message => {\n    const receiverId = currentChat.members.find(member => member !== currentUser.uid);\n    socket.current.emit(\"sendMessage\", {\n      senderId: currentUser.uid,\n      receiverId: receiverId,\n      message: message\n    });\n    const messageBody = {\n      chatRoomId: currentChat._id,\n      sender: currentUser.uid,\n      message: message\n    };\n    const res = await sendMessage(messageBody);\n    setMessages([...messages, res]);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"lg:col-span-2 lg:block\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-3 bg-white border-b border-gray-200 dark:bg-gray-900 dark:border-gray-700\",\n        children: /*#__PURE__*/_jsxDEV(Contact, {\n          chatRoom: currentChat,\n          currentUser: currentUser\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative w-full p-6 overflow-y-auto h-[30rem] bg-white border-b border-gray-200 dark:bg-gray-900 dark:border-gray-700\",\n        children: /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"space-y-2\",\n          children: messages.map((message, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: scrollRef,\n            children: /*#__PURE__*/_jsxDEV(Message, {\n              message: message,\n              self: currentUser.uid\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 17\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ChatForm, {\n        handleFormSubmit: handleFormSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatRoom, \"zC8727W43RsSkE4OvRTh/TsTWPg=\");\n_c = ChatRoom;\nvar _c;\n$RefreshReg$(_c, \"ChatRoom\");","map":{"version":3,"names":["useState","useEffect","useRef","getMessagesOfChatRoom","sendMessage","Message","Contact","ChatForm","jsxDEV","_jsxDEV","ChatRoom","currentChat","currentUser","socket","_s","messages","setMessages","incomingMessage","setIncomingMessage","scrollRef","fetchData","res","_id","_scrollRef$current","current","scrollIntoView","behavior","_socket$current","on","data","senderId","message","prev","handleFormSubmit","receiverId","members","find","member","uid","emit","messageBody","chatRoomId","sender","className","children","chatRoom","fileName","_jsxFileName","lineNumber","columnNumber","map","index","ref","self","_c","$RefreshReg$"],"sources":["/home/lenovo/IdeaProjects/lets-chat/frontend/src/components/chat/ChatRoom.js"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\n\nimport { getMessagesOfChatRoom, sendMessage } from \"../../services/ChatService\";\n\nimport Message from \"./Message\";\nimport Contact from \"./Contact\";\nimport ChatForm from \"./ChatForm\";\n\nexport default function ChatRoom({ currentChat, currentUser, socket }) {\n  const [messages, setMessages] = useState([]);\n  const [incomingMessage, setIncomingMessage] = useState(null);\n\n  const scrollRef = useRef();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const res = await getMessagesOfChatRoom(currentChat._id);\n      setMessages(res);\n    };\n\n    fetchData();\n  }, [currentChat._id]);\n\n  useEffect(() => {\n    scrollRef.current?.scrollIntoView({\n      behavior: \"smooth\",\n    });\n  }, [messages]);\n\n  useEffect(() => {\n    socket.current?.on(\"getMessage\", (data) => {\n      setIncomingMessage({\n        senderId: data.senderId,\n        message: data.message,\n      });\n    });\n  }, [socket]);\n\n  useEffect(() => {\n    incomingMessage && setMessages((prev) => [...prev, incomingMessage]);\n  }, [incomingMessage]);\n\n  const handleFormSubmit = async (message) => {\n    const receiverId = currentChat.members.find(\n      (member) => member !== currentUser.uid\n    );\n\n    socket.current.emit(\"sendMessage\", {\n      senderId: currentUser.uid,\n      receiverId: receiverId,\n      message: message,\n    });\n\n    const messageBody = {\n      chatRoomId: currentChat._id,\n      sender: currentUser.uid,\n      message: message,\n    };\n    const res = await sendMessage(messageBody);\n    setMessages([...messages, res]);\n  };\n\n  return (\n    <div className=\"lg:col-span-2 lg:block\">\n      <div className=\"w-full\">\n        <div className=\"p-3 bg-white border-b border-gray-200 dark:bg-gray-900 dark:border-gray-700\">\n          <Contact chatRoom={currentChat} currentUser={currentUser} />\n        </div>\n\n        <div className=\"relative w-full p-6 overflow-y-auto h-[30rem] bg-white border-b border-gray-200 dark:bg-gray-900 dark:border-gray-700\">\n          <ul className=\"space-y-2\">\n            {messages.map((message, index) => (\n              <div key={index} ref={scrollRef}>\n                <Message message={message} self={currentUser.uid} />\n              </div>\n            ))}\n          </ul>\n        </div>\n\n        <ChatForm handleFormSubmit={handleFormSubmit} />\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}